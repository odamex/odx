<div class="content-section" #contentSection>
  <h2>Network Settings</h2>
  <p class="text-muted mb-4">Configure local network server discovery and scanning</p>
  
  <!-- Local Network Discovery Card -->
  <app-settings-card>
    <div card-icon class="d-flex align-items-center justify-content-center flex-shrink-0">
      <i class="bi bi-hdd-network"></i>
    </div>
    <div card-title>
      <h3>Local Network Discovery</h3>
    </div>
      <div class="setting-item">
        <div class="form-check form-switch">
          <input 
            class="form-check-input" 
            type="checkbox" 
            id="localDiscoveryEnabled"
            [checked]="localDiscoveryEnabled()"
            (change)="toggleLocalDiscovery()">
          <label class="form-check-label" for="localDiscoveryEnabled">
            <strong>Enable local network scanning</strong>
          </label>
        </div>
        <small class="text-muted">
          Automatically discover Odamex servers on your local network that may not be listed on the master server
        </small>
      </div>

      @if (localDiscoveryEnabled()) {
        <!-- Scan Status -->
        @if (localDiscoveryScanning()) {
          <div class="alert alert-info d-flex align-items-center gap-2 mt-3 mb-3">
            <div class="spinner-border spinner-border-sm" role="status">
              <span class="visually-hidden">Scanning...</span>
            </div>
            <span>Scanning local networks...</span>
          </div>
        } @else if (localDiscoveryLastScan()) {
          <div class="text-muted mt-3 mb-3">
            <small>
              <i class="bi bi-clock-history me-1"></i>
              Last scan: {{ localDiscoveryLastScan() | date:'short' }}
            </small>
          </div>
        }

        <!-- Detected Networks -->
        @if (localDiscoveryNetworks().length > 0) {
          <div class="mt-3 mb-3">
            <h5 class="text-muted mb-2" style="font-size: 0.875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">Detected Networks</h5>
            <div class="detected-networks-list">
              @for (network of localDiscoveryNetworks(); track network.name) {
                <div class="network-item">
                  <div class="network-icon">
                    <i class="bi bi-ethernet"></i>
                  </div>
                  <div class="network-info">
                    <div class="network-name">{{ network.name }}</div>
                    <div class="network-details">
                      <span class="network-address">{{ network.address }}</span>
                      <span class="network-separator">/</span>
                      <span class="network-mask">{{ network.netmask }}</span>
                    </div>
                  </div>
                  <div class="network-cidr">
                    <span class="badge">{{ network.cidr }}</span>
                  </div>
                  <div class="network-toggle">
                    <div class="form-check form-switch">
                      <input 
                        class="form-check-input" 
                        type="checkbox" 
                        role="switch" 
                        [id]="'network-settings-' + network.cidr"
                        [checked]="network.enabled"
                        (change)="toggleNetwork(network.cidr)"
                      >
                      <label class="form-check-label" [for]="'network-settings-' + network.cidr">
                        {{ network.enabled ? 'Enabled' : 'Disabled' }}
                      </label>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <!-- Advanced Settings (Collapsible) -->
        <div class="mt-3">
          <button 
            class="btn btn-sm btn-link text-decoration-none p-0 d-flex align-items-center gap-1"
            type="button"
            (click)="toggleAdvancedDiscovery()">
            <i class="bi" [class.bi-chevron-right]="!showAdvancedDiscovery()" [class.bi-chevron-down]="showAdvancedDiscovery()"></i>
            <span>Advanced Settings</span>
          </button>

          @if (showAdvancedDiscovery()) {
            <div class="mt-3 ms-3 border-start border-2 ps-3">
              <!-- Port Range -->
              <div class="mb-3">
                <label class="form-label mb-1">
                  <strong>Port Range</strong>
                </label>
                <small class="text-muted d-block mb-2">
                  Range of ports to scan for servers (default: 10666-10675)
                </small>
                <div class="d-flex align-items-center gap-2" style="max-width: 350px;">
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    id="portRangeStart"
                    min="1024"
                    max="65535"
                    [value]="localDiscoveryPortStart()"
                    (input)="updatePortRangeStart(+$any($event.target).value)">
                  <span>to</span>
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    id="portRangeEnd"
                    min="1024"
                    max="65535"
                    [value]="localDiscoveryPortEnd()"
                    (input)="updatePortRangeEnd(+$any($event.target).value)">
                </div>
              </div>

              <!-- Scan Timeout -->
              <div class="mb-3">
                <label for="scanTimeout" class="form-label mb-1">
                  <strong>Scan Timeout</strong>
                </label>
                <small class="text-muted d-block mb-2">
                  How long to wait for each server response (default: 200ms)
                </small>
                <div class="input-group" style="max-width: 200px;">
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    id="scanTimeout"
                    min="50"
                    max="5000"
                    step="50"
                    [value]="localDiscoveryScanTimeout()"
                    (input)="updateScanTimeout(+$any($event.target).value)">
                  <span class="input-group-text">ms</span>
                </div>
              </div>

              <!-- Refresh Interval -->
              <div class="mb-3">
                <label for="refreshInterval" class="form-label mb-1">
                  <strong>Refresh Interval</strong>
                </label>
                <small class="text-muted d-block mb-2">
                  How often to automatically rescan local networks (default: 60s)
                </small>
                <div class="input-group" style="max-width: 200px;">
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    id="refreshInterval"
                    min="10"
                    max="600"
                    step="10"
                    [value]="localDiscoveryRefreshInterval()"
                    (input)="updateRefreshInterval(+$any($event.target).value)">
                  <span class="input-group-text">seconds</span>
                </div>
              </div>

              <!-- Max Concurrent Queries -->
              <div class="mb-0">
                <label for="maxConcurrent" class="form-label mb-1">
                  <strong>Max Concurrent Queries</strong>
                </label>
                <small class="text-muted d-block mb-2">
                  Maximum number of simultaneous server queries (default: 50)
                </small>
                <div class="input-group" style="max-width: 200px;">
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    id="maxConcurrent"
                    min="1"
                    max="200"
                    [value]="localDiscoveryMaxConcurrent()"
                    (input)="updateMaxConcurrent(+$any($event.target).value)">
                  <span class="input-group-text">queries</span>
                </div>
              </div>
            </div>
          }
        </div>

        <!-- Manual Scan Button -->
        <div class="mt-3">
          <button 
            class="btn btn-primary btn-sm"
            [disabled]="localDiscoveryScanning()"
            (click)="triggerLocalScan()">
            <i class="bi bi-arrow-repeat me-1"></i>
            <span>Scan Now</span>
          </button>
        </div>
      }
  </app-settings-card>
</div>
